function shortcutHandler(){var a=loginModule.guessLoginForm()?!0:!1;cardModule.guessCreditCardForm()?!0:!1;chrome.runtime.sendMessage({header:"shortcutPressed",isLogin:a,tabUrl:getParentUrl(),tabId:activeTabInfo.tabId})}function captureDataAndSendToBackground(a,b){if(a){var c=null;"FORM"!==a.nodeName&&"A"!==a.nodeName&&(c=a.form),"FORM"===a.nodeName&&(c=a);var d=loginModule.createPageFieldDict(),e=loginModule.guessLoginForm(d),f=changePasswordModule.guessChangePasswordForm();if(e&&"A"===a.nodeName){var g=null;e.pointer?g=loginModule.findLoginAnchor(e):e.loginButton&&(g=e.loginButton),!g||g.pointer!==a&&g!==a||sendLoginFields(e)}else if(c&&e&&c===e.pointer)sendLoginFields(e);else if(c&&f&&c===f.pointer||f&&f.vPasswordFields){var h=f.vPasswordFields,i=h[0].pointer.value,j=h[1].pointer.value;if(2===h.length){if(""===i||""===j)return;i===j?chrome.runtime.sendMessage({header:"changePswdSubmitEvent",newPassword:j}):chrome.runtime.sendMessage({header:"changePswdSubmitEvent",oldPassword:i,newPassword:j})}if(3===h.length){var k=h[2].pointer.value;if(""===i||""===j||""===k)return;chrome.runtime.sendMessage({header:"changePswdSubmitEvent",oldPassword:i,newPassword:j})}}else if(e&&e.pswdField&&e.pswdField.htmlValue)e.userField&&e.userField.pointer===a||e.pswdField.pointer===a||e.loginButton&&e.loginButton.pointer===a?sendLoginFields(e):e.parentForm&&e.parentForm===a&&sendLoginFields(e);else if("A"!==a.nodeName){var l=cardModule.guessCreditCardForm();if(!l){var m=[];m=c?loginModule.getFormSpecificFields(d,c):d;for(var n=m?m.length:0,o=-1,p=null,q=null,r=n-1;r>=0;r--){var s=m[r];if("password"===s.htmlType&&s.htmlLength&&s.htmlLength>4&&s.htmlValue){if(!b){p=s.htmlValue,o=r-1;break}if(s.pointer.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING){p=s.htmlValue,o=r-1;break}}}if(-1!==o)for(var r=o;r>=0;r--){var s=m[r],t=s.htmlType;if(("text"===t||"email"===t||"number"===t)&&s.htmlValue){q=s.htmlValue;break}}p&&(q?chrome.runtime.sendMessage({header:"loginSubmitEvent",username:q,password:p,tabId:activeTabInfo.tabId}):chrome.runtime.sendMessage({header:"loginSubmitEvent",password:p,tabId:activeTabInfo.tabId}))}}}}function captureClickEvent(){document.addEventListener("click",function(a){for(var b=a.target;"SPAN"===b.nodeName;)b=b.parentNode;var c=!1,d=b.getAttribute("type"),e=b.nodeName;if(d&&(d=d.toLowerCase()),"INPUT"===e&&("button"===d||"submit"===d||"image"===d)||"BUTTON"===e){var f=b.getAttribute("value")||b.getAttribute("alt")||b.getAttribute("src");if(f){if(1===f.length&&"INPUT"===e)return}else if("BUTTON"===e){if(f=b.textContent||b.innerText,f=f.trim(),1===f.length)return}else b.id&&(f=b.id.toLowerCase().indexOf("signin")||b.id.toLowerCase().indexOf("login")?"signin":null),b.name&&(f=b.name.toLowerCase().indexOf("signin")||b.name.toLowerCase().indexOf("login")?"signin":null);if(f){var g="search;reset;clear;caps;space;close;cancel;back;previous;next;forgot password;here;subscribe;comment".split(";");c=g.every(function(a){return f=f.toLowerCase().trim(),-1===f.indexOf(a)})}}else if("A"===e){var h=b.textContent||b.text;if(h){h=h.replace(/^\s+/m,"").replace(/\s+$/m,"").replace(/\s\s+/," ").toLowerCase().trim();var i="signin,login,signon,sign on,log in,sign in,log on,logon,登  录,登录,Inloggen,einloggen,giriş,zaloguj,लॉग इन करें,valider,accedi,anmelden,weiter,accès,вход,kirjaudu,zaloguj się,let me in,credentials,authentication,authenticate,next,ok,submit,enter,entrar,continue,connexion,sisenen,toliau,далее".split(","),j=i.every(function(a){return-1===h.indexOf(a)});if(j)return}c=!0}else b=filterItemClicked(a.target),b&&(c=!0);c&&captureDataAndSendToBackground(b,!0)},!0)}function sendLoginFields(a){var b=null;if(b=a.hasOwnProperty("userField")||a.hasOwnProperty("pswdField")?a:loginModule.identifyLoginFields(a)){var c=b.userField?b.userField.htmlValue:null,d=b.pswdField?b.pswdField.htmlValue:null;d&&(c?chrome.runtime.sendMessage({header:"loginSubmitEvent",username:c,password:d,tabId:activeTabInfo.tabId}):chrome.runtime.sendMessage({header:"loginSubmitEvent",password:d,tabId:activeTabInfo.tabId}))}}function modifyShortcutKey(a){return-1!==navigator.appVersion.indexOf("Mac")&&(-1!==a.indexOf("ctrl")&&-1===a.indexOf("meta")?a=a.replace("ctrl","meta"):-1!==a.indexOf("meta")&&-1===a.indexOf("ctrl")&&(a=a.replace("meta","ctrl"))),-1!==a.indexOf("pgup")&&(a=a.replace("pgup","pageup")),-1!==a.indexOf("pgdown")&&(a=a.replace("pgdown","pagedown")),a}function filterItemClicked(a){var b="signon;sign on;login;log in;log in securely;log on;login now;sign in;einloggen;登  录;signin;continue;submit;weiter;accès;вход;connexion;entrar;anmelden;accedi;valider;登录;लॉग इन करें;giriş".split(";"),c=a.textContent||a.innerText;if(!c)return null;c=c.replace(/^\s+/m,"").replace(/\s+$/m,"").replace(/\s\s+/," ").toLowerCase().trim();var d=b.every(function(a){return a===c?!1:!0});if(d)return null;var e=a.ownerDocument,f=Array.prototype.slice.call(e.forms)||Array.prototype.slice.call(e.getElementsByTagName("form"));if(!f||f&&0===f.length)return null;for(var g=0;g<f.length;++g)if(f[g].contains(a))return f[g]}function filterItemEntered(a){var b=a.getAttribute("placeholder")||"",c=a.getAttribute("class")||"",d=a.getAttribute("id")||"",e=a.getAttribute("name")||"",f=/(search|find|zoek|поиск|найти|искать|recherche|suchen|buscar|suche|ricerca|procurar|検索)/i,g=b.match(f)||c.match(f)||d.match(f)||e.match(f);return g?null:a}function getParentUrl(){var a=parent!==window,b=null;return b=a?document.referrer:window.location.href}var loginForm=null,identityForm=null,creditCardForm=null,config={},activeTabInfo={};document.addEventListener("DOMContentLoaded",function(a){chrome.runtime.sendMessage({header:"get_shortcut"})}),window.addEventListener("keydown",function(a){var b=a.target.type;if(13===a.keyCode&&("password"===b||"text"===b||"email"===b)){var c=filterItemEntered(a.target);captureDataAndSendToBackground(c,!1)}},!0),chrome.runtime.onMessage.addListener(function(a,b,c){switch(a.header){case"setActiveTabInfo":delete a.header,activeTabInfo=a;break;case"enpass_loginfill":loginForm=loginModule.guessLoginForm(),loginForm&&(loginModule.fillLoginForm(loginForm,a.card),a=null);break;case"enpass_cardfill":creditCardForm||(creditCardForm=cardModule.guessCreditCardForm()),cardModule.fillCreditCardForm(creditCardForm,a.card),a=null;break;case"guess_form":loginForm=loginModule.guessLoginForm(),creditCardForm=cardModule.guessCreditCardForm();var d=loginForm?!0:!1,e=creditCardForm?!0:!1,f=!1;d?f?chrome.runtime.sendMessage({header:"guess_form_result",isLogin:d,isIdentity:f}):chrome.runtime.sendMessage({header:"guess_form_result",isLogin:d}):e?f?chrome.runtime.sendMessage({header:"guess_form_result",isCreditCard:e,isIdentity:f}):chrome.runtime.sendMessage({header:"guess_form_result",isCreditCard:e}):f?chrome.runtime.sendMessage({header:"guess_form_result",isIdentity:f}):chrome.runtime.sendMessage({header:"guess_form_result"});break;case"enpass_identityfill":identityForm&&0!==identityForm.length||(identityForm=identityModule.guessIdentityForms(!0)),identityModule.fillIdentityForm(identityForm,a.card);break;case"set_shortcut_for_autofill":if(a.shortcutKey){var g=a.shortcutKey.toLowerCase();config&&config.keyShortcut&&Mousetrap.unbind(config.keyShortcut),a.isShortcutOverride||(g=modifyShortcutKey(g)),config.keyShortcut=g,Mousetrap.bindGlobal(config.keyShortcut,function(){shortcutHandler()},"keydown")}else config&&config.keyShortcut&&Mousetrap.unbind(config.keyShortcut);break;case"fillGeneratedPassword":a.generatedPassword&&loginModule.fillPasswordFields(a.generatedPassword)}}),captureClickEvent();