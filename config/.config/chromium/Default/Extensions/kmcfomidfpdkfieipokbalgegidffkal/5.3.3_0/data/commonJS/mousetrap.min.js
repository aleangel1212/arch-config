!function(a,b,c){function d(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function e(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return l[a.which]?l[a.which]:m[a.which]?m[a.which]:String.fromCharCode(a.which).toLowerCase()}function f(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function g(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function h(a,b){var c,d,e,f=[];for(c=a,"+"===c?c=["+"]:(c=c.replace(/\+{2}/g,"+plus"),c=c.split("+")),e=0;e<c.length;++e)d=c[e],o[d]&&(d=o[d]),b&&"keypress"!=b&&n[d]&&(d=n[d],f.push("shift")),g(d)&&f.push(d);if(c=d,e=b,!e){if(!k){k={};for(var h in l)h>95&&112>h||l.hasOwnProperty(h)&&(k[l[h]]=h)}e=k[c]?"keydown":"keypress"}return"keypress"==e&&f.length&&(e="keydown"),{key:d,modifiers:f,action:e}}function i(a,c){return a===b?!1:a===c?!0:i(a.parentNode,c)}function j(a){function c(a){a=a||{};var b,c=!1;for(b in q)a[b]?c=!0:q[b]=0;c||(t=!1)}function i(a,b,c,d,e,f){var h,i,j=[],k=c.type;if(!o._callbacks[a])return[];for("keyup"==k&&g(a)&&(b=[a]),h=0;h<o._callbacks[a].length;++h)if(i=o._callbacks[a][h],(d||!i.seq||q[i.seq]==i.level)&&k==i.action){var l;(l="keypress"==k&&!c.metaKey&&!c.ctrlKey)||(l=i.modifiers,l=b.sort().join(",")===l.sort().join(",")),l&&(l=d&&i.seq==d&&i.level==f,(!d&&i.combo==e||l)&&o._callbacks[a].splice(h,1),j.push(i))}return j}function k(a,b,c,d){o.stopCallback(b,b.target||b.srcElement,c,d)||!1!==a(b,c)||(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}function l(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=e(a);b&&("keyup"==a.type&&r===b?r=!1:o.handleKey(b,f(a),a))}function m(a,b,d,f){function g(b){return function(){t=b,++q[a],clearTimeout(p),p=setTimeout(c,1e3)}}function i(b){k(d,b,a),"keyup"!==f&&(r=e(b)),setTimeout(c,10)}for(var j=q[a]=0;j<b.length;++j){var l=j+1===b.length?i:g(f||h(b[j+1]).action);n(b[j],l,f,a,j)}}function n(a,b,c,d,e){o._directMap[a+":"+c]=b,a=a.replace(/\s+/g," ");var f=a.split(" ");1<f.length?m(a,f,b,c):(c=h(a,c),o._callbacks[c.key]=o._callbacks[c.key]||[],i(c.key,c.modifiers,{type:c.action},d,a,e),o._callbacks[c.key][d?"unshift":"push"]({callback:b,modifiers:c.modifiers,action:c.action,seq:d,level:e,combo:a}))}var o=this;if(a=a||b,!(o instanceof j))return new j(a);o.target=a,o._callbacks={},o._directMap={};var p,q={},r=!1,s=!1,t=!1;o._handleKey=function(a,b,d){var e,f=i(a,b,d);b={};var h=0,j=!1;for(e=0;e<f.length;++e)f[e].seq&&(h=Math.max(h,f[e].level));for(e=0;e<f.length;++e)f[e].seq?f[e].level==h&&(j=!0,b[f[e].seq]=1,k(f[e].callback,d,f[e].combo,f[e].seq)):j||k(f[e].callback,d,f[e].combo);f="keypress"==d.type&&s,d.type!=t||g(a)||f||c(b),s=j&&"keydown"==d.type},o._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)n(a[d],b,c)},d(a,"keypress",l),d(a,"keydown",l),d(a,"keyup",l)}var k,l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},m={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},o={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"};for(c=1;20>c;++c)l[111+c]="f"+c;for(c=0;9>=c;++c)l[c+96]=c;j.prototype.bind=function(a,b,c){return a=a instanceof Array?a:[a],this._bindMultiple.call(this,a,b,c),this},j.prototype.unbind=function(a,b){return this.bind.call(this,a,function(){},b)},j.prototype.trigger=function(a,b){return this._directMap[a+":"+b]&&this._directMap[a+":"+b]({},a),this},j.prototype.reset=function(){return this._callbacks={},this._directMap={},this},j.prototype.stopCallback=function(a,b){return-1<(" "+b.className+" ").indexOf(" mousetrap ")||i(b,this.target)?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},j.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},j.init=function(){var a,c=j(b);for(a in c)"_"!==a.charAt(0)&&(j[a]=function(a){return function(){return c[a].apply(c,arguments)}}(a))},j.init(),a.Mousetrap=j,"undefined"!=typeof module&&module.exports&&(module.exports=j),"function"==typeof define&&define.amd&&define(function(){return j})}(window,document);